#DATABASE SERVER

- hosts: host03

  vars_files: 
  - ./main.yml

  tasks:
  - name: install mariadb_server
    apt:
      name: 
        - mysql-server
        - python3-pip
        - python3-setuptools
        - python3-pymysql
      state: present
      update_cache: yes  


        
# tasks file for mara_db

  - name: Install the Python MySQLB module
    pip: name=mysql-connector

  - name: Create MySQL client config
    copy:
      dest: "/root/.my.cnf"
      content: |
        [client]
        user=root
        password={{ root_password }}
      mode: 0400

#  - name: Allow external MySQL connexions 
#    lineinfile:
#      path: /etc/mysql/mysql.conf.d/mysqld.cnf
#      regexp: '^bind-address'
#      line: "# bind-address"
#      service:
#        name=mysql
#        state=restart

  - name: upload sql table config
    copy:
      src: "./app/create_stucture.sql"
      dest: "/tmp/create_stucture.sql"

  - name : moving mysql home
    user:
      name: mysql
      home: /var/lib/mysql
  
  - name: Start MariaDB                                                                           
    service:                                                 
      name=mysql                          
      state=started
